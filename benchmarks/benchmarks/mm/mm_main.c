// See LICENSE for license details.

#include "common.h"
#include <assert.h>
#include <stdlib.h>
#include <stdio.h>
#include "util.h"

t input1_data_mm[24*25] = 
{
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
};

t input2_data_mm[25*24] = 
{
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5,
};

t output_data_mm[25*25] = 
{
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
    0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 0, 3, 2, 0, 3, 1, 2, 3, 5, 7,
};


#pragma GCC optimize ("unroll-loops")

void thread_entry(int cid, int nc)
{
  const int R = 8;
  int m, n, p;
  uint64_t s = 0xdeadbeefU;
  
  m = CBM;
  n = CBN;
  p = CBK;

  size_t instret, cycles;
  for (int i = 0; i < R; i++)
  {
    instret = -read_csr(minstret);
    cycles = -read_csr(mcycle);
    mm(m, n, p, input1_data_mm, p, input2_data_mm, n, output_data_mm, n);
    instret += read_csr(minstret);
    cycles += read_csr(mcycle);
  }

  // Signal that the program is complete.
  asm volatile("sw x0, (x0);");
  // Busy wait for the simulation to complete.
  while (1);

  exit(0);
}
